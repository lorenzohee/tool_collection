//  http://www.weipet.cn/ 网站的爬取

var Crawler = require("crawler");
require('./model/mongoose')
const Cat = require('./model/cat')
let queryQueue = ["http://www.ichong123.com/gougou/zangao","http://www.ichong123.com/gougou/kejiquan","http://www.ichong123.com/gougou/jiwawa","http://www.ichong123.com/gougou/lasjxueqiaoquan","http://www.ichong123.com/gougou/afhliequan","http://www.ichong123.com/gougou/aodaliequan","http://www.ichong123.com/gougou/houmianquan","http://www.ichong123.com/gougou/aozhougen","http://www.ichong123.com/gougou/arlslq","http://www.ichong123.com/gougou/azmnq","http://www.ichong123.com/gougou/arlllq","http://www.ichong123.com/gougou/aierlangeng","http://www.ichong123.com/gougou/antmyq","http://www.ichong123.com/gougou/ajdwg","http://www.ichong123.com/gougou/azmyq","http://www.ichong123.com/gougou/arlxdq","http://www.ichong123.com/gougou/bigequan","http://www.ichong123.com/gougou/bjglffdq","http://www.ichong123.com/gougou/boruiquan","http://www.ichong123.com/gougou/bltnlq","http://www.ichong123.com/gougou/boliquan","http://www.ichong123.com/gougou/baxianjiquan","http://www.ichong123.com/gougou/bixiong","http://www.ichong123.com/gougou/bjmyq","http://www.ichong123.com/gougou/boenshanq","http://www.ichong123.com/gougou/bianjinggeng","http://www.ichong123.com/gougou/bjdlq","http://www.ichong123.com/gougou/blstnlq","http://www.ichong123.com/gougou/blsmlnq","http://www.ichong123.com/gougou/brsecmlq","http://www.ichong123.com/gougou/beilingdungeng","http://www.ichong123.com/gougou/boshidungeng","http://www.ichong123.com/gougou/bomeiquan","http://www.ichong123.com/gougou/bage","http://www.ichong123.com/gougou/clswxlq","http://www.ichong123.com/gougou/chaiquan","http://www.ichong123.com/gougou/douniuquan","http://www.ichong123.com/gougou/drssdq","http://www.ichong123.com/gougou/dddmg","http://www.ichong123.com/gougou/damaiting","http://www.ichong123.com/gougou/dgmyq","http://www.ichong123.com/gougou/dnmstfq","http://www.ichong123.com/gougou/dubinquan","http://www.ichong123.com/gougou/dabaixiong","http://www.ichong123.com/gougou/fldsxmq","http://www.ichong123.com/gougou/flwlq","http://www.ichong123.com/gougou/fenlanliequan","http://www.ichong123.com/gougou/guibinquan","http://www.ichong123.com/gougou/gdmyq","http://www.ichong123.com/gougou/gdcxmyq","http://www.ichong123.com/gougou/gmzsgfq","http://www.ichong123.com/gougou/gdxdq","http://www.ichong123.com/gougou/gaojiasuoquan","http://www.ichong123.com/gougou/haliquan","http://www.ichong123.com/gougou/hlmsq","http://www.ichong123.com/gougou/hupangeng","http://www.ichong123.com/gougou/hhslhxq","http://www.ichong123.com/gougou/huibitequan","http://www.ichong123.com/gougou/hashiqi","http://www.ichong123.com/gougou/haweina","http://www.ichong123.com/gougou/hudiequan","http://www.ichong123.com/gougou/jinmaoquan","http://www.ichong123.com/gougou/jmxhq","http://www.ichong123.com/gougou/jklsg","http://www.ichong123.com/gougou/jingba","http://www.ichong123.com/gougou/keka","http://www.ichong123.com/gougou/klblyq","http://www.ichong123.com/gougou/kaililangeng","http://www.ichong123.com/gougou/kananquan","http://www.ichong123.com/gougou/kemengquan","http://www.ichong123.com/gougou/kuwasiquan","http://www.ichong123.com/gougou/sikaigeng","http://www.ichong123.com/gougou/kaiangeng","http://www.ichong123.com/gougou/luoweinaquan","http://www.ichong123.com/gougou/luosuquan","http://www.ichong123.com/gougou/ldxyjbq","http://www.ichong123.com/gougou/labuladuo","http://www.ichong123.com/gougou/lasaquan","http://www.ichong123.com/gougou/liehugeng","http://www.ichong123.com/gougou/lingti","http://www.ichong123.com/gougou/liehuquan","http://www.ichong123.com/gougou/luoweishigeng","http://www.ichong123.com/gougou/luofugeng","http://www.ichong123.com/gougou/lachangquan","http://www.ichong123.com/gougou/mqstg","http://www.ichong123.com/gougou/mgslq","http://www.ichong123.com/gougou/mgasjmq","http://www.ichong123.com/gougou/mgstfjg","http://www.ichong123.com/gougou/maerjisi","http://www.ichong123.com/gougou/mstfq","http://www.ichong123.com/gougou/nwlmq","http://www.ichong123.com/gougou/niutougeng","http://www.ichong123.com/gougou/ptysq","http://www.ichong123.com/gougou/pmxhq","http://www.ichong123.com/gougou/pmhlg","http://www.ichong123.com/gougou/quanshiquan","http://www.ichong123.com/gougou/qiutianquan","http://www.ichong123.com/gougou/qsbklq","http://www.ichong123.com/gougou/ribenzhong","http://www.ichong123.com/gougou/rmmsg","http://www.ichong123.com/gougou/songshiquan","http://www.ichong123.com/gougou/sellq","http://www.ichong123.com/gougou/sugelangeng","http://www.ichong123.com/gougou/shapigou","http://www.ichong123.com/gougou/shibingge","http://www.ichong123.com/gougou/saluji","http://www.ichong123.com/gougou/simaogeng","http://www.ichong123.com/gougou/shibinuoquan","http://www.ichong123.com/gougou/stgjdng","http://www.ichong123.com/gougou/samoyequan","http://www.ichong123.com/gougou/saishiliequan","http://www.ichong123.com/gougou/suboqiqun","http://www.ichong123.com/gougou/sglllq","http://www.ichong123.com/gougou/sglmyq","http://www.ichong123.com/gougou/shengbona","http://www.ichong123.com/gougou/taidiquan","http://www.ichong123.com/gougou/weimaquan","http://www.ichong123.com/gougou/wesjflq","http://www.ichong123.com/gougou/wannenggeng","http://www.ichong123.com/gougou/weizilaquan","http://www.ichong123.com/gougou/xilediquan","http://www.ichong123.com/gougou/xigaodiquan","http://www.ichong123.com/gougou/xishiquan","http://www.ichong123.com/gougou/xilihangeng","http://www.ichong123.com/gougou/xizanggeng","http://www.ichong123.com/gougou/xunxueliequan","http://www.ichong123.com/gougou/xizangliequan","http://www.ichong123.com/gougou/xuenarui","http://www.ichong123.com/gougou/ybslq","http://www.ichong123.com/gougou/ygxdq","http://www.ichong123.com/gougou/yuekexiaquan","http://www.ichong123.com/gougou/zggmq","http://www.ichong123.com/gougou/268","http://www.ichong123.com/gougou/16103","http://www.ichong123.com/gougou/16107","http://www.ichong123.com/gougou/16209","http://www.ichong123.com/gougou/16210","http://www.ichong123.com/gougou/16213","http://www.ichong123.com/gougou/16214","http://www.ichong123.com/gougou/16216","http://www.ichong123.com/gougou/16219","http://www.ichong123.com/gougou/16221","http://www.ichong123.com/gougou/16225","http://www.ichong123.com/gougou/16228","http://www.ichong123.com/gougou/16235","http://www.ichong123.com/gougou/16239","http://www.ichong123.com/gougou/16241","http://www.ichong123.com/gougou/16242","http://www.ichong123.com/gougou/16245","http://www.ichong123.com/gougou/16248","http://www.ichong123.com/gougou/16251","http://www.ichong123.com/gougou/16255","http://www.ichong123.com/gougou/16260","http://www.ichong123.com/gougou/16263","http://www.ichong123.com/gougou/16342","http://www.ichong123.com/gougou/16344","http://www.ichong123.com/gougou/16345","http://www.ichong123.com/gougou/16347","http://www.ichong123.com/gougou/16349","http://www.ichong123.com/gougou/16354","http://www.ichong123.com/gougou/16357","http://www.ichong123.com/gougou/16358","http://www.ichong123.com/gougou/16361","http://www.ichong123.com/gougou/16364","http://www.ichong123.com/gougou/16366","http://www.ichong123.com/gougou/16368","http://www.ichong123.com/gougou/16370","http://www.ichong123.com/gougou/16373","http://www.ichong123.com/gougou/16376","http://www.ichong123.com/gougou/16378","http://www.ichong123.com/gougou/16380","http://www.ichong123.com/gougou/16382","http://www.ichong123.com/gougou/16384","http://www.ichong123.com/gougou/16389","http://www.ichong123.com/gougou/38865","http://www.ichong123.com/gougou/38941","http://www.ichong123.com/gougou/39027","http://www.ichong123.com/gougou/39116","http://www.ichong123.com/gougou/39182","http://www.ichong123.com/gougou/39259","http://www.ichong123.com/gougou/39343","http://www.ichong123.com/gougou/39416","http://www.ichong123.com/gougou/39476","http://www.ichong123.com/gougou/39526","http://www.ichong123.com/gougou/39600","http://www.ichong123.com/gougou/39651","http://www.ichong123.com/gougou/39692","http://www.ichong123.com/gougou/39738","http://www.ichong123.com/gougou/39782","http://www.ichong123.com/gougou/39844","http://www.ichong123.com/gougou/39905","http://www.ichong123.com/gougou/39983","http://www.ichong123.com/gougou/40035","http://www.ichong123.com/gougou/40136","http://www.ichong123.com/gougou/40182","http://www.ichong123.com/gougou/40246","http://www.ichong123.com/gougou/40554","http://www.ichong123.com/gougou/40555","http://www.ichong123.com/gougou/40556","http://www.ichong123.com/gougou/41671"]

function saveContent(body) {
    new Cat(body).save()
    console.log(`${queryQueue[0]} 的数据已保存！`)
}

var c = new Crawler({
    maxConnections : 10, //最大并发数
    // rateLimit: 100, //慢速模式，间隔10毫秒
    forceUTF8: true,
    // 在每个请求处理完毕后将调用此回调函数
    callback : function (error, res, done) {
        if(error){
            console.log(error);
        }else{
            var $ = res.$;
            // $ 默认为 Cheerio 解析器
            // 它是核心jQuery的精简实现，可以按照jQuery选择器语法快速提取DOM元素

            let body = res.body
            let obj = {
              name: /<span>全名：(.+?)<\/span>/g.exec(body) && /<span>全名：(.+?)<\/span>/g.exec(body)[1],
              desc: $('.sintro').text().trim(),
              url: res.request.uri.href,
              wool: /<span>毛长：(.+?)<\/span>/g.exec(body) && /<span>毛长：(.+?)<\/span>/g.exec(body)[1],
              othername: /<span>别名：(.+?)<\/span>/g.exec(body) && /<span>别名：(.+?)<\/span>/g.exec(body)[1],
              life: /<span>寿命：(.+?)<\/span>/g.exec(body) && /<span>寿命：(.+?)<\/span>/g.exec(body)[1],
              height: /<span>身高：(.+?)<\/span>/g.exec(body) && /<span>身高：(.+?)<\/span>/g.exec(body)[1],
              area: /<span>原产地：(.+?)<\/span>/g.exec(body) && /<span>原产地：(.+?)<\/span>/g.exec(body)[1],
              price: /<span>价格：(.+?)<\/span>/g.exec(body) && /<span>价格：(.+?)<\/span>/g.exec(body)[1],
              weight: /<span>体型：(.+?)<\/span>/g.exec(body) && /<span>体型：(.+?)<\/span>/g.exec(body)[1],
              stickiness: /<span>粘人程度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body) && /<span>粘人程度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body)[1],
              call: /<span>喜叫程度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body) && /<span>喜叫程度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body)[1],
              woolleft: /<span>掉毛程度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body) && /<span>掉毛程度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body)[1],
              traning: /<span>可训练度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body) && /<span>可训练度：<code class=\"star(.+?)\"><i><\/i><\/code><\/span>/g.exec(body)[1],
              avatar: $('.specimg').find('img').attr('src')
            }
            saveContent(obj)
        }
        done();
    }
});

c.queue(queryQueue);